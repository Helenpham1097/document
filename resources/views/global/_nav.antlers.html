<div class="relative z-10">
    <div class="absolute -inset-0.5 rounded-xl bg-gradient-to-r from-zinc-200/0 via-zinc-200 to-zinc-200/0 opacity-40 dark:from-zinc-500/0 dark:via-zinc-500 dark:to-zinc-500/0 dark:opacity-20"></div>

    <nav class="relative w-full bg-white py-4 text-zinc-700 dark:bg-zinc-900 dark:text-zinc-200 sm:py-0">
        <div x-data="{ open: false }" class="container mx-auto flex flex-row items-center justify-between">
            {{# Logo #}}
            <div class="flex flex-row items-center justify-between xl:mr-12">
                {{ partial:global/_logo }}
            </div>

            {{# Main nav #}}
            <div class="flex flex-row items-center justify-between space-x-4 xl:flex-grow" role="navigation">
                {{# Desktop menu #}}
                <div class="relative hidden items-center lg:flex">
                    <div
                        x-data="{
							navigationMenuOpen: false,
							navigationMenu: '',
							navigationMenuCloseDelay: 200,
							navigationMenuCloseTimeout: null,
							navigationMenuLeave() {
								let that = this;
								this.navigationMenuCloseTimeout = setTimeout(() => {
									that.navigationMenuClose();
								}, this.navigationMenuCloseDelay);
							},
							navigationMenuReposition(navElement) {
								this.navigationMenuClearCloseTimeout();
								this.$refs.navigationDropdown.style.left = navElement.offsetLeft + 'px';
								this.$refs.navigationDropdown.style.marginLeft = (navElement.offsetWidth/2) + 'px';
							},
							navigationMenuClearCloseTimeout(){
								clearTimeout(this.navigationMenuCloseTimeout);
							},
							navigationMenuClose(){
								this.navigationMenuOpen = false;
								this.navigationMenu = '';
							}
						}"
                        class="relative z-10 w-auto"
                    >
                        <div class="relative">
                            <ul class="group flex flex-1 list-none items-center space-x-1 text-zinc-700 dark:text-zinc-100">
                                {{ nav:main_menu show_unpublished="true" }} {{ if children }}
                                <li>
                                    <button
                                        :class="{ 'bg-zinc-100 dark:bg-zinc-800' : navigationMenu=='{{ title | slugify }}', 'hover:bg-zinc-100 dark:hover:bg-zinc-500' : navigationMenu!='{{ title | slugify }}' }"
                                        @mouseover="navigationMenuOpen=true; navigationMenuReposition($el); navigationMenu='{{ title | slugify }}'"
                                        @mouseleave="navigationMenuLeave()"
                                        class="group inline-flex h-10 w-max items-center justify-center rounded-md px-4 py-2 text-sm font-medium transition-colors hover:text-zinc-900 focus:outline-none disabled:pointer-events-none disabled:opacity-50 dark:hover:text-zinc-100"
                                    >
                                        <span>{{ title }}</span>
                                        <span class="ml-2 duration-300 ease-out" :class="{ '-rotate-180' : navigationMenuOpen==true && navigationMenu == '{{ title | slugify }}' }">
                                            {{ svg src="{{config:iconamic:path}}/chevron-down.svg" class='size-3' }}
                                        </span>
                                    </button>
                                </li>
                                {{ else }}
                                <li>
                                    <a
                                        href="{{ url }}"
                                        class="bg-background group inline-flex h-10 w-max items-center justify-center rounded-md px-4 py-2 text-sm font-medium transition-colors hover:bg-zinc-100 hover:text-zinc-900 focus:outline-none disabled:pointer-events-none disabled:opacity-50 dark:hover:bg-zinc-800 dark:hover:text-zinc-100"
                                    >
                                        {{ title }}
                                    </a>
                                </li>
                                {{ /if }} {{ /nav:main_menu }}
                            </ul>
                        </div>

                        <div
                            x-ref="navigationDropdown"
                            x-show="navigationMenuOpen"
                            x-transition:enter="transition ease-out duration-100"
                            x-transition:enter-start="opacity-0 scale-90"
                            x-transition:enter-end="opacity-100 scale-100"
                            x-transition:leave="transition ease-in duration-100"
                            x-transition:leave-start="opacity-100 scale-100"
                            x-transition:leave-end="opacity-0 scale-90"
                            @mouseover="navigationMenuClearCloseTimeout()"
                            @mouseleave="navigationMenuLeave()"
                            class="absolute top-0 -translate-x-1/2 translate-y-11 pt-3 duration-200 ease-out"
                            x-cloak
                            style="display: none;"
                        >
                            <div class="flex h-auto w-auto justify-center overflow-hidden rounded-md border border-zinc-200/70 bg-white shadow-2xl dark:border-zinc-800/70 dark:bg-zinc-900">
                                {{ nav:main_menu show_unpublished="true" }} {{ if children }}
                                <div x-show="navigationMenu == '{{ title | slugify }}'" class="flex w-full max-w-2xl items-stretch justify-center gap-x-3 p-6">
                                    <div class="w-48 flex-shrink-0 rounded bg-gradient-to-br from-purple-800 to-purple-900 pt-28 pb-7">
                                        <div class="relative space-y-1.5 px-7 text-white">
                                            {{ if iconamic }}
                                            <div class="transition duration-500 ease-in-out transform group-hover:translate-x-1">
                                                {{ svg src="{{ config:iconamic:path }}/{{iconamic}}.svg" class="size-9 flex-none" }}
                                            </div>
                                            {{ /if }}
                                            <span class="block font-bold">{{ title }}</span>
                                            <span class="block text-xs opacity-60 line-clamp-2">{{ page_description | safe_truncate:60:'...' }}</span>
                                        </div>
                                    </div>
                                    <div class="w-72">
                                        {{ children }}
                                        <a href="{{ url }}" @click="navigationMenuClose()" class="block rounded px-3.5 py-3 text-sm hover:bg-zinc-100 dark:hover:bg-zinc-800">
                                            <span class="mb-1 block font-medium text-black dark:text-white">{{ title }}</span>
                                            {{ if page_description }}
                                            <span class="block font-light leading-5 opacity-50">
                                                {{ page_description | safe_truncate:60:'...' }}
                                            </span>
                                            {{ /if }}
                                        </a>
                                        {{ /children }}
                                    </div>
                                </div>
                                {{ /if }} {{ /nav:main_menu }}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="lg:flex items-center space-x-6 lg:border-l hidden lg:border-zinc-200 lg:dark:border-zinc-800 xl:pl-6">
                    {{ partial:global/theme_toggle }}
                    {{ partial:components/button label="Login" button_type='inline' link_type="url" url="{{ site_information:login }}" }}
                    {{ partial:components/button label="Sign up" class="!py-1.5 !pl-3 !pr-1.5" button_type='secondary' link_type="url" url="{{ site_information:sign_up }}" iconamic="chevron-right" }}
                </div>
                {{# modal mobile menu #}}
                <div id="Modal" x-data="{ open: false }" @open-me="open=true" class="block lg:hidden" @close-me="open=false">
                    <div class="flex items-center gap-6">
                        {{ partial:components/button label="Sign up" class="flex-none !py-2 !px-4" button_type='secondary' link_type="url" url="{{ site_information:sign_up }}" }}
                        <button
                            type="button"
                            aria-label="menu"
                            class="inline-flex w-full justify-center text-base font-medium text-zinc-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 dark:text-zinc-200 sm:w-auto sm:text-sm"
                            @click.prevent="open = true"
                        >
                            <span class="sr-only">Navigation</span>
                            <span x-show="!open">
                                {{ svg src="{{config:iconamic:path}}/menu.svg" class='size-9' }}
                            </span>
                            <span x-show="open" style="display: none;">
                                {{ svg src="{{config:iconamic:path}}/x.svg" class='size-9' }}
                            </span>
                        </button>
                    </div>

                    {{# Modal #}}
                    <div @keydown.window.escape="open = false" x-show="open" class="relative z-10" aria-labelledby="modal-title" x-ref="dialog" aria-modal="true">
                        {{# Overlay #}}
                        <div
                            x-show="open"
                            x-transition:enter="ease-out duration-300"
                            x-transition:enter-start="opacity-0"
                            x-transition:enter-end="opacity-100"
                            x-transition:leave="ease-in duration-200"
                            x-transition:leave-start="opacity-100"
                            x-transition:leave-end="opacity-0"
                            x-description="Background backdrop, show/hide based on modal state."
                            class="fixed inset-0 bg-zinc-800 bg-opacity-75 backdrop-blur-sm transition-opacity"
                            style="display: none;"
                        ></div>

                        {{# Panel #}}
                        <div class="fixed inset-0 z-10 overflow-y-auto">
                            <div class="relative flex">
                                <div
                                    x-show="open"
                                    x-trap.noscroll.inert="open"
                                    x-transition:enter="ease-out duration-300"
                                    x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                                    x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
                                    x-transition:leave="ease-in duration-200"
                                    x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
                                    x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                                    x-description="Modal panel, show/hide based on modal state."
                                    class="absolute sm:top-4 sm:right-4 transform overflow-hidden rounded-lg bg-white p-6 text-left font-semibold shadow-xl transition-all dark:bg-zinc-800 w-full sm:max-w-sm"
                                    @click.away="open = false"
                                    style="display: none;"
                                >
                                    {{# Close menu #}}
                                    <button
                                        @click="open = !open"
                                        type="button"
                                        class="absolute top-5 right-5 flex h-8 w-8 items-center justify-center text-zinc-500 hover:text-zinc-600 dark:text-zinc-400 dark:hover:text-zinc-300"
                                        tabindex="0"
                                    >
                                        <span class="sr-only">Close navigation</span>
                                        {{ svg src="{{config:iconamic:path}}/x.svg" class='size-9' }}
                                    </button>
                                    {{# Close menu #}}
                                    <ul class="divide-y sm:mt-6 mt-3 dark:divide-zinc-700 divide-zinc-300">
                                        {{ nav:main_menu show_unpublished="true" }} {{ if children }}
                                        <div @click.away="open = false" class="relative" x-data="{ open: false }">
                                            <button @click="open = !open" class="hover:text-purple-500 rounded w-full py-3 justify-between dark:hover:text-purple-400 flex text-xl items-center gap-2">
                                                <div class="flex gap-2 items-center">
                                                    {{ if iconamic }}
                                                    <div class="flex size-10 min-w-10 shrink-0 items-center justify-center rounded-lg">
                                                        {{ svg src="{{config:iconamic:path}}/{{iconamic}}.svg" class="size-5 flex-none" }}
                                                    </div>
                                                    {{ /if }}
                                                    <span>{{ title }}</span>
                                                </div>
                                                {{ svg src="{{config:iconamic:path}}/chevron-down.svg" class='size-5 inline ' }}
                                            </button>
                                            <div
                                                x-show="open"
                                                x-transition:enter="transition ease-out duration-100"
                                                x-transition:enter-start="transform opacity-0 scale-95"
                                                x-transition:enter-end="transform opacity-100 scale-100"
                                                x-transition:leave="transition ease-in duration-75"
                                                x-transition:leave-start="transform opacity-100 scale-100"
                                                x-transition:leave-end="transform opacity-0 scale-95"
                                                class="right-0 text-sm text-zinc-500 dark:text-zinc-300 pb-4 w-full origin-top-right rounded-md lg:absolute lg:w-48 lg:shadow-lg"
                                            >
                                                {{ children }}
                                                <a
                                                    role="menuitem"
                                                    class="{{ if is_current || is_parent }} dark:text-green-400 text-purple-500 {{ /if }} group/menu-item text-zinc-700 dark:text-zinc-400 hover:text-zinc-800 dark:hover:text-zinc-300 focus-visible:ring-zinc-lighter focus-visible:text-zinc flex select-none items-center gap-3 rounded-md py-2 text-sm leading-none no-underline outline-none focus-visible:ring-2"
                                                    href="{{ url }}"
                                                >
                                                    {{ if iconamic }}
                                                    <div class="dark:bg-zinc-700 bg-zinc-50 border border-zinc-200 dark:border-zinc-600 flex size-10 min-w-10 shrink-0 items-center justify-center rounded-lg">
                                                        {{ svg src="{{config:iconamic:path}}/{{iconamic}}.svg" class="size-5 flex-none" }}
                                                    </div>
                                                    {{ /if }}
                                                    <div class="flex flex-col justify-center">
                                                        <div class="flex items-center gap-1">
                                                            <p class="text-zinc-700 dark:text-zinc-300 leading-snug">
                                                                {{ title }}
                                                            </p>
                                                        </div>
                                                        <p class="text-zinc-400 dark:text-zinc-400 group-hover/menu-item:text-zinc-light group-focus-visible/menu-item:text-zinc-light -mb-1 line-clamp-1 leading-relaxed">
                                                            {{ page_description | safe_truncate:60:'...' }}
                                                        </p>
                                                    </div>
                                                </a>
                                                {{ /children }}
                                            </div>
                                        </div>
                                        {{ else }}
                                        <li>
                                            <a class="hover:text-purple-500 {{ if page_description }} items-start {{ else }} items-center {{ /if}} rounded py-3 flex gap-2 text-xl" href="{{ url }}">
                                                {{ if iconamic }}
                                                <div class="flex size-10 min-w-10 shrink-0 items-center justify-center rounded-lg">
                                                    {{ svg src="{{config:iconamic:path}}/{{iconamic}}.svg" class="size-5 flex-none" }}
                                                </div>
                                                {{ /if }}
                                                <div>
                                                    {{ title }} {{ if page_description }}
                                                    <span class="block mt-1 text-xs opacity-50">{{ page_description | safe_truncate:60:'...' }}</span>
                                                    {{ /if }}
                                                </div>
                                            </a>
                                        </li>
                                        {{ /if }} {{ /nav:main_menu }}
                                    </ul>
                                    {{ partial:components/button label="Login" class="" button_type='inline' link_type="url" url="{{ site_information:login }}" }}
                                    <div class="flex items-center">
                                        <button
                                            aria-label="Theme toggle"
                                            class="{{ class }} relative flex items-center space-x-2 rounded-full border border-zinc-200 p-2 text-zinc-500 shadow-sm transition hover:shadow dark:border-zinc-600 dark:text-zinc-200 lg:flex-none lg:space-x-0 lg:p-0"
                                            x-data="{
                                                    toggle: () => {
                                                        if (localStorage.theme === 'dark' || document.documentElement.classList.contains('dark')) {
                                                            localStorage.theme = 'light';
                                                            document.documentElement.classList.remove('dark');
                                                            document.documentElement.style.colorScheme = '';
                                                            document.querySelector('#svg-sm-moon').classList.toggle('hidden', false);
                                                            document.querySelector('#svg-sm-sun').classList.toggle('hidden', true);
                                    
                                                        } else {
                                                            localStorage.theme = 'dark';
                                                            document.documentElement.classList.add('dark');
                                                            document.documentElement.style.colorScheme = 'dark';
                                                            document.querySelector('#svg-sm-moon').classList.toggle('hidden', true);
                                                            document.querySelector('#svg-sm-sun').classList.toggle('hidden', false);
                                                        }
                                                    },
                                                }"
                                            @click="toggle">
                                            {{ slot }}
                                            <span class="flex h-6 w-6 items-center rounded-full bg-white transition dark:bg-zinc-700 lg:shadow-md">
                                                {{# {# Sun icon #} #}}
                                                {{ svg src="{{config:iconamic:path}}/sun.svg" id="svg-sm-sun" class='size-4 mx-auto' }}
                                                {{# {# Moon icon #} #}}
                                                {{ svg src="{{config:iconamic:path}}/moon.svg" id="svg-sm-moon" class='size-4 mx-auto' }}
                                            </span>
                                        </button>
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>
</div>