---
id: a8c36ff7-2598-431e-8bc9-5c3c620f27de
blueprint: blog
author: fa61bd1a-7054-4dd6-974f-a1764a47c4ec
title: 'Presentation (Aug 2020): Building a modern hosting platform using serverless'
excerpt: 'Almost a year before Webslice launched our CTO, Quintin, explained to a Serverless meetup why we care so much about PHP and WordPress.'
description: 'Webslise makes it easy to deploy PHP websites like WordPress on serverless infrastructure. CTO Quintin Russ introduced Webslice at this August 2020 meetup.'
template: blog/blog
template_global: /global/default_image
default_image: serverless-nights-php-quinitin.png
page_builder:
  -
    template: /general_content/_article
    article:
      -
        type: paragraph
        content:
          -
            type: text
            text: 'In August 2020 I was invited to speak at Auckland''s /serverless/NIGHTS meetup about Webslice. While we were still building towards MVP, we had learned useful lessons to share with our local community, and I threw in a couple of work-in-progress live demos, too.'
      -
        type: set
        attrs:
          values:
            type: figure
            image: serverless-nights-php-quinitin.png
            size: lg
      -
        type: paragraph
        content:
          -
            type: text
            text: 'In particular, I wanted to talk about opening serverless up to PHP applications, including WordPress. What if you could just take today’s standard-issue websites and run them on serverless?'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'This ‘lift and shift’ to serverless had the impression we were hoping for. One attendee even said we’d “reinvented the legacy hosting challenge”!'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'Here’s a recap of my talk, so you can see whether you agree.'
      -
        type: heading
        attrs:
          level: 2
        content:
          -
            type: text
            marks:
              -
                type: bold
            text: 'Making serverless more accessible'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'To put our ambition for Webslice in one sentence, we’re making serverless more accessible to developers. As I put it, Webslice is a modern hosting platform that makes extensive use of serverless. The orchestration systems are 100% serverless, for example.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'To put our ambition for Webslice in one sentence, we’re making serverless more accessible to developers. Webslice is a modern hosting platform that makes extensive use of serverless. The orchestration systems are 100% serverless, for example.'
      -
        type: code_block
        content:
          -
            type: text
            text: '<iframe src="https://docs.google.com/presentation/d/e/2PACX-1vQS9XL5CJGQ6NyexrNuh5e6-xXlDPd8wosQWuLlloOo7r-b2vJkkTe1sN5TP3KIir19SWBRjkQB6CxO/embed?start=false&loop=false&delayms=5000" frameborder="0" width="960" height="569" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>'
      -
        type: heading
        attrs:
          level: 2
        content:
          -
            type: text
            marks:
              -
                type: bold
            text: 'PHP is everywhere, so that’s where we’re starting'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'Webslice is new, and serverless isn’t exactly old hat (yet), so people can be surprised to learn that we’re focused on good ol’ PHP.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'We’ve started with PHP because it’s the most popular backend programming language for websites today. Almost 8/10 websites are written in PHP and 35% are on WordPress, the most popular content management system (CMS) in the world.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'So, PHP matters. As well as that, PHP works. At SiteHost we have infrastructure including our Domain Registration, DNS management and VM provisioning systems that we developed on PHP. Some of my code from 14 years ago is still there today!'
      -
        type: blockquote
        content:
          -
            type: paragraph
            content:
              -
                type: text
                marks:
                  -
                    type: bold
                text: 'Most businesses aren’t planning to rewrite their PHP systems just to go serverless. So we’re bringing serverless to them.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'I believe that PHP, and in particular LAMP stack, was responsible for the original serverless movement. It’s single threaded, the process is stateless and thousands of companies worldwide can take your code and have it "just run".'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'I also believe that event-driven computing is the future for hosting apps, and will keep getting better. But I sometimes wonder if we''ve lost our way with modern approaches to deploying code into the cloud and serverless platforms. Serverless is just one piece of the overall solution that lets developers spend less time worrying about infrastructure and more time focused on code.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'As for the other pieces, hosting companies have known for years what people need: A simple user experience, fantastic support when you get stuck and open standards so you can easily develop locally or shift providers when you want to.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'PHP has historically ticked all of those other boxes, but scaling it up on demand and to zero when quiet has been quite difficult.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'How difficult? Ask AWS.'
      -
        type: heading
        attrs:
          level: 2
        content:
          -
            type: text
            marks:
              -
                type: bold
            text: 'Serverless WordPress is not a piece of cake'
      -
        type: paragraph
        content:
          -
            type: text
            text: "Here’s the\_"
          -
            type: text
            marks:
              -
                type: link
                attrs:
                  href: 'https://aws.amazon.com/blogs/architecture/wordpress-best-practices-on-aws/'
                  rel: null
                  target: null
                  title: null
              -
                type: bold
            text: 'AWS reference architecture for WordPress'
          -
            type: text
            text: '. It’s...complex.'
      -
        type: set
        attrs:
          values:
            type: figure
            image: wordpress-on-aws.png
            size: lg
      -
        type: paragraph
        content:
          -
            type: text
            text: 'For a company blog or website, this is a serious amount of infrastructure and it’s going to come with a similarly serious bill. For most companies you can see why serverless is in the “too hard” basket.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'Some of this complexity comes from WordPress itself. By default there are three features of WordPress, and other CMSs, make it tricky to deploy in serverless:'
      -
        type: ordered_list
        attrs:
          order: 1
        content:
          -
            type: list_item
            content:
              -
                type: paragraph
                content:
                  -
                    type: text
                    text: 'Image upload without plugins'
          -
            type: list_item
            content:
              -
                type: paragraph
                content:
                  -
                    type: text
                    text: 'Plugin installation'
          -
            type: list_item
            content:
              -
                type: paragraph
                content:
                  -
                    type: text
                    text: 'WordPress’s self-update functionality'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'Together, these all assume a writeable filesystem for images and for PHP files.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'This makes git-based deployments very complex and opinionated. I often refer to this as a “shared state” problem because you end up with different sources of truth if you use, say, git for storing your codebase and then install plugins into your hosted environment on the filesystem and database.'
      -
        type: heading
        attrs:
          level: 2
        content:
          -
            type: text
            marks:
              -
                type: bold
            text: 'Who is WordPress + Lambda for?'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'Looking at the complex architecture above, and thinking about the millions of WordPress sites out there, you have to ask who exactly WordPress + Lambda is for.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'Before EFS it was mostly mad scientists (like me) who configured code pipelines to build Lambda layers and the like. Even while doing that, I was thinking “this isn’t for anyone”.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'In June 2020 AWS launched network file system (NFS) support for Lambda, with a service called EFS (the E stands for “elastic”). Still, cost and performance mean that running WordPress on Lambda natively still isn’t the best choice for, well, anyone.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'I’ll dig into those cost and performance points soon.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'For now let’s say that 35% of the world’s websites can’t realistically run on Lambda. Site owners have good reasons to avoid building the complex architecture above, and they don’t want to deploy their site onto a VM that they have to patch, monitor and resize.'
      -
        type: heading
        attrs:
          level: 2
        content:
          -
            type: text
            marks:
              -
                type: bold
            text: 'Enter Webslice'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'All of which brings us to Webslice, and the serverless filesystem that we’ve written for it. (If you weren’t in the room for this talk, let me assure you that there were dramatic gasps when I mentioned that we’ve built our own filesystem. One guy even fainted, I swear.)'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'There’ll be more to say about the filesystem, but first let’s see how Webslice works. What could be a better example of not worrying about infrastructure than literally taking a WordPress zip file and having it run inside Lambda?'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'THIS VIDEO OUGHT TO BE REPLACED WITH QUINTIN PRESENTING TO CAMERA'
      -
        type: set
        attrs:
          values:
            type: video
            youtube_url: 'https://vimeo.com/423108095'
            size: lg
      -
        type: paragraph
        content:
          -
            type: text
            marks:
              -
                type: link
                attrs:
                  href: 'https://vimeo.com/423108095'
                  rel: null
                  target: null
                  title: null
              -
                type: bold
            text: 'WordPress on Webslice'
          -
            type: text
            text: "\_from\_"
          -
            type: text
            marks:
              -
                type: link
                attrs:
                  href: 'https://vimeo.com/user116488652'
                  rel: null
                  target: null
                  title: null
              -
                type: bold
            text: Webslice
          -
            type: text
            text: "\_on\_"
          -
            type: text
            marks:
              -
                type: link
                attrs:
                  href: 'https://vimeo.com/'
                  rel: null
                  target: null
                  title: null
              -
                type: bold
            text: Vimeo
          -
            type: text
            text: .
      -
        type: paragraph
        content:
          -
            type: text
            text: 'The video above (which in my original talk was a nerve-wracking live demo) shows installation of a completely unmodified instance of WordPress, then an image being uploaded via the backend and displayed on a page. Simple.'
      -
        type: heading
        attrs:
          level: 2
        content:
          -
            type: text
            marks:
              -
                type: bold
            text: 'Anyway, about that filesystem'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'You might wonder why a small hosting company in NZ decided to write our own filesystem. You might wonder if we’re crazy. I know I have.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'We’re not just light on innovation tokens now - we are in overdraft. This is easily the hardest project the team and I have undertaken, but it wasn’t a random choice.'
      -
        type: blockquote
        content:
          -
            type: paragraph
            content:
              -
                type: text
                marks:
                  -
                    type: bold
                text: 'The fact is that there hasn''t been any real innovation in filesystems for decades.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'Who''s still waiting for Btrfs to be stable? Ext4 was released to hold us over, and that was 12 years ago. S3 is probably the best example from the last 20 years but it''s a stretch to call it a filesystem, and it was launched 14 years ago.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'EFS (AWS’s managed NFS service) is simply not good enough to deploy PHP code onto due to...well, physics basically. There are costs involved and AWS does a good job of passing all of them through to your bill.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'So after researching all the storage options available in AWS and a couple of other cloud providers, I called one of our engineers and said, “look, I really, really don''t want to be doing this, and I’m going to regret it - but I think we should develop a filesystem for Lambda”.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'To over-simplify, here’s how our work compares to EFS, in four categories:'
      -
        type: set
        attrs:
          values:
            type: table
            size: lg
            first_row_headers: true
            first_column_headers: false
            table:
              -
                cells:
                  - null
                  - EFS
                  - 'Serverless FS'
              -
                cells:
                  - "Read Latency\t"
                  - "High\t"
                  - Low
              -
                cells:
                  - "Write Latency\t"
                  - "High\t"
                  - "High\t"
              -
                cells:
                  - Serverless
                  - Questionable
                  - 'Yes'
              -
                cells:
                  - Cost
                  - '$0.36/GB + $6/MBps IOPs'
                  - 'Significantly less than EFS'
      -
        type: paragraph
        content:
          -
            type: text
            marks:
              -
                type: bold
            text: 'Read latency'
          -
            type: text
            text: "\_matters a lot, because websites are often made up of thousands of PHP files, and typical workloads in PHP hosting environments are read-heavy. Our serverless filesystem excels in read-heavy workloads."
      -
        type: paragraph
        content:
          -
            type: text
            text: '(If you’ve worked with PHP you might suggest that using Opcache - formerly APC - with EFS could help with performance. This is partly correct, but would require coldstart optimisations. Even then applications that install plugins often do directory or file checks to see if a plugin is installed before including the files. These bypass Opcache checks and introduce additional latency to your application.)'
      -
        type: paragraph
        content:
          -
            type: text
            text: "With\_"
          -
            type: text
            marks:
              -
                type: bold
            text: 'write latency'
          -
            type: text
            text: ', there’s more that we think we can do here once we’ve shipped MVP. Most production websites frequently write to their database and infrequently to disk.'
      -
        type: paragraph
        content:
          -
            type: text
            text: "From a\_"
          -
            type: text
            marks:
              -
                type: bold
            text: serverless
          -
            type: text
            text: "\_perspective I’ve marked EFS as questionable. The filesystem won’t scale under load without provisioning IOPs whether you use them or not."
      -
        type: paragraph
        content:
          -
            type: text
            text: "Lastly,\_"
          -
            type: text
            marks:
              -
                type: bold
            text: cost
          -
            type: text
            text: '. This is a bit cheeky since we haven’t launched or announced pricing, but from the workloads we’ve tested we’re extremely confident our serverless filesystem will be significantly cheaper than EFS and perform as you’d expect.'
      -
        type: heading
        attrs:
          level: 3
        content:
          -
            type: text
            marks:
              -
                type: bold
            text: 'Other Lambda limits'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'Aside from the filesystem a couple of other Lambda limits make it tricky to host PHP websites. We’ve worked through systematically to improve them and have a few other ideas up our sleeves to truly make Webslice a great experience.'
      -
        type: set
        attrs:
          values:
            type: table
            size: lg
            first_row_headers: true
            first_column_headers: false
            table:
              -
                cells:
                  - null
                  - Lambda
                  - Webslice
              -
                cells:
                  - "POST payload size\t"
                  - "6MB\t"
                  - 25MB
              -
                cells:
                  - "Deployment size\t"
                  - "250MB (uncompressed)\t"
                  - '500MB (uncompressed)'
              -
                cells:
                  - "Writable filesystem\t"
                  - EFS
                  - 'Serverless FS'
              -
                cells:
                  - "Snapshot support\t"
                  - "No\t"
                  - 'Yes'
      -
        type: paragraph
        content:
          -
            type: text
            text: "The\_"
          -
            type: text
            marks:
              -
                type: bold
            text: 'POST payload size'
          -
            type: text
            text: "\_is a bit frustrating, especially if you upload larger files regularly. Large POST payloads typically aren’t sub-100ms due to the processing that’s done. So for large POST requests our API Gateway uploads the file to s3, and then the Lambda function downloads the file and transparently passes it off to PHP for processing as normal."
      -
        type: paragraph
        content:
          -
            type: text
            text: "The\_"
          -
            type: text
            marks:
              -
                type: bold
            text: 'deployment size'
          -
            type: text
            text: "\_is a bigger limitation. I expect these limits to be increased in the future, but for now we’ve come up with a solution that lets a website have up to 500MB of PHP source code, and no limit or complexity for images, log files or other content you want to host."
      -
        type: paragraph
        content:
          -
            type: text
            text: "We also make it nice and easy to copy\_"
          -
            type: text
            marks:
              -
                type: bold
            text: snapshots
          -
            type: text
            text: "\_on write. This respects the gravity of data and lets you roll forward and back. All serverless, and all in a standards-compatible way."
      -
        type: heading
        attrs:
          level: 2
        content:
          -
            type: text
            marks:
              -
                type: bold
            text: 'Applications like WordPress aren’t a priority elsewhere'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'Webslice isn’t the only project in the world that’s making PHP on Lambda easier. Bref, for example, is open source and is probably the best solution for PHP developers who are comfortable using the serverless framework. If you’re writing something bespoke that doesn’t need a writable filesystem or you can customise your code to use EFS in a cost-effective and performant way, Bref could be for you.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'They’re making progress, too. This is Bref’s Maturity Matrix from March 2019:'
      -
        type: set
        attrs:
          values:
            type: figure
            image: bref-maturity-mar19.jpeg
            size: lg
            caption: 'And here’s a screenshot I took last week (August 2020):'
      -
        type: set
        attrs:
          values:
            type: figure
            image: bref-maturity-aug20.png
            size: lg
      -
        type: paragraph
        content:
          -
            type: text
            text: 'WordPress falls under “Legacy application”, where the red and orange dots are. It’s where Bref is least mature, and it’s where we have been focusing.'
      -
        type: heading
        attrs:
          level: 2
        content:
          -
            type: text
            marks:
              -
                type: bold
            text: 'On-ramp to JAMSTACK'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'You might ask: so what if I can scale my PHP website to zero? What does that really achieve? Well, lots. One example is JAMSTACK - Javascript, APIs and Markup.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'The concept behind JAMSTACK is to pre-render your website as static content which is fast, cheap and secure.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'It is still early days for this approach and the user experience has some way to come, but a number of CMS’s are currently transitioning towards being headless - with JAMSTACK frontends and dynamic content management in serverless environments. The future for websites could very much look like only invoking Lambda when you want to update a page or post a comment.'
      -
        type: heading
        attrs:
          level: 2
        content:
          -
            type: text
            marks:
              -
                type: bold
            text: 'Not just WordPress'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'We are not just supporting WordPress. Webslice is a platform that makes it easy to write and deploy any PHP code to Lambda. If you’ve written code last week, last year or in the last decade (as long as it runs on PHP 5.6 or up), you can use Webslice to run that code in Serverless.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'I’ll show you one more demo, before we wrap up - and this time, we’re going to focus on a Silverstripe demo + Git and we’ll roll a deploy back using the snapshot feature.'
      -
        type: set
        attrs:
          values:
            type: video
            youtube_url: 'https://www.youtube.com/watch?v=Zs9Tifup1Bc'
            size: lg
            caption: 'SECOND VIDEO GOES HERE'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'And with that second live demo, my talk was done. The /serverless/NIGHTS community liked what they saw, and it was fun demonstrating our progress. Since this talk we’ve…[achieved more stuff, conclusion TBD].'
    type: article
    enabled: true
updated_by: bdf0548e-f14e-4b7d-9abd-d2223cb02cec
updated_at: 1666821100
---
